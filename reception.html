<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>受付</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script type="text/javascript" src="/socket.io/socket.io.js"></script>
</head>

<body>

  <select name="roomName" id="roomName" size="5">
    <option value="room1">room1</option>
    <option value="room2">room2</option>
    <option value="room3">room3</option>
    <option value="room4">room4</option>
    <option value="room5">room5</option>
  </select>
  <input type="button" value="追加" id="add">

  <form>
    <select class="list" name="allList" id="allList" size="20"></select>
  </form>

  <script>
    window.onload = function () {
      var socket = io.connect();
      const addButton = document.getElementById('add')
      const roomName = document.getElementById('roomName');
      const allList = document.getElementById('allList');

      socket.on('server_to_client', function (data) {
        console.log('rece33' + data.value);
        write(data.value);
      })
      function write(data) {
        removeAllChildren(allList);
        for (let i = 0; i < data.length; i++) {
          let a = document.createElement('option');
          let b = document.createTextNode(data[i]);
          a.appendChild(b);
          allList.appendChild(a);
        }
      }

      addButton.onclick = function () {
        let rmnm = roomName.value;
        if (!rmnm) {
          alert('部屋が登録されていません');
        } else {
          socket.emit('client_to_server', { value: rmnm, meth: 'add' })

        }
      }
      /*addButton.onclick = function () {
        console.log('rece44');
        const a = document.getElementById('roomName');
        const b = a.value;
        if (b.length === 0) { alert('部屋が登録されていません'); return; }
        try {
          socket.emit('client_to_server', { value: b, meth: 'add' });
        } catch (error) { }

      }*/


    }
    function removeAllChildren(element) {
      while (element.firstChild) {
        element.removeChild(element.firstChild);
      }
    }

  </script>

</body>

</html>