<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <title>修正画面</title>
  <script type="text/javascript" src="/socket.io/socket.io.js"></script>
</head>

<body>
  <div>
    <select id="allList" size="20" onclick="listSelected()"></select>
    <select id="sousa" disabled size="2" >
      <option onclick="sousa('status')">部屋、状態の変更</option>
      <option onclick="sousa('cancel')">呼び出しの取り消し</option>
    </select>
    <select id="selectRoom" disabled size="13" onclick="newSelected()">
      <% for( let i=1; i < 14; i++ ) { %>
        <option value="診療室<%= i %>">診療室<%= i %>
        </option>
        <% } %>
    </select>
    <select id="selectStatus" disabled size="4" onclick="newSelected()">
      <option value="受付">受付</option>
      <option value="診療室">診療室</option>
      <option value="会計">会計</option>
      <option value="終了">終了</option>
    </select>
    <button id="cancel" onclick="on('cancel')">戻る</button>
    <button id="submit" onclick="on('submit')" disabled>決定</button>
    <button id="fullscreen" onclick="on('fullscreen')">全画面</button>
  </div>

  <style>

  </style>
  <script>
    //画面起動時の処理
    window.onload = function () {
      request('reqList', 'null')
      let listData = [];
      let allList = document.getElementById('allList');
      let sousaList = document.getElementById('sousa');
      let selectRoom = document.getElementById('selectRoom');
      let selectStatus = document.getElementById('selectStatus');
      let submit = document.getElementById('submit');
      let confirm = document.getElementById('confirm');
    }
    //ソケット通信 リストの受け取り、表示
    var socket = io.connect();
    socket.on('resList', function (data) {
      listData = data.value;
      while (allList.firstChild) {
        allList.removeChild(allList.firstChild);
      }
      for (let i = 1; i < listData.length; i++) {
        let a = document.createElement('option');
        let b = document.createTextNode(listData[i].number + ',' + listData[i].room + ',' + listData[i].status);
        a.value = i;
        a.appendChild(b);
        allList.appendChild(a);
      }
    })
    //ボタンが押された時の処理
    function on(name) {
      switch (name) {
        case 'fullscreen':
          document.body.requestFullscreen();
          break;
        case 'cancel':
          window.history.back();
          break;
        case 'submit':
          let number = allList.value;
          let newRoom = selectRoom.value;
          let newStatus = selectStatus.value;
          let result = confirm(number + '番' + '\n' + listData[number].room + '→' + newRoom + '\n' + listData[number].status + '→' + newStatus)
          if (result) {
            if (newRoom.length > 0) {
              request('newRoom', { num: number, room: newRoom });
            }
            if (newStatus.length > 0) {
              request('newStatus', { num: number, status: newStatus });
            }
          }
          break;
      }
    }
    //選択された時に次の選択肢を表示
    function listSelected() {
      let value = allList.value;
      console.log('list1');
      if (value.length !== 0) {
        console.log('list2');
        submit.disabled = false;
        let sousaList=document.getElementById('sousa');
        sousaList.disabled=false;
      }
    }
    //選択された時に次の選択肢を表示
    function newSelected() {
      let value = selectRoom.value + selectStatus.value;
      if (value.length !== 0) {
        submit.disabled = false;
      }
    }

    function sousa(sousa) {
      switch (sousa) {
        case 'status':
          selectRoom.disabled = false;
          selectStatus.disabled = false;
          submit.disabled=true;
          break;
        case 'cancel':
          submit.disabled=false;
          selectRoom.disabled = true;
          selectStatus.disabled = true;
      }
    }
  </script>
  <%-include('correctLog')%>
    <%-include('socket')%>


</body>